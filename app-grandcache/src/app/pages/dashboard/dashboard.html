<div class="dashboard-container fade-in">

  <div id="heroCarousel" class="carousel slide shadow-lg mb-5 rounded-4 overflow-hidden" data-bs-ride="carousel">
    <div class="carousel-inner">

      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>

      <div class="carousel-item active" data-bs-interval="5000">
        <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1000&auto=format&fit=crop" class="d-block w-100 hero-img" alt="Tecnología">
        <div class="carousel-caption d-none d-md-block glass-caption p-4 rounded-3" style="margin-bottom: 30px;">
          <h2 class="fw-bold">Bienvenido a GrandCache</h2>
          <p class="fs-5">Gestiona tu negocio a detalle.</p>
        </div>
      </div>

      <div class="carousel-item" data-bs-interval="5000">
        <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=1000&auto=format&fit=crop" class="d-block w-100 hero-img" alt="Seguridad">
        <div class="carousel-caption d-none d-md-block glass-caption p-4 rounded-3" style="margin-bottom: 30px;">
          <h2 class="fw-bold">Control Total</h2>
          <p class="fs-5">Monitorea cada entrada y salida en tiempo real.</p>
        </div>
      </div>

      <div class="carousel-item" data-bs-interval="5000">
        <img src="https://images.unsplash.com/photo-1667372459534-848ec00d4da7?q=80&w=1332&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="d-block w-100 hero-img" alt="Conectividad">
        <div class="carousel-caption d-none d-md-block glass-caption p-4 rounded-3" style="margin-bottom: 30px;">
          <h2 class="fw-bold">Interconectividad</h2>
          <p class="fs-5">Conecta todos tus elementos en un solo lugar.</p>
        </div>
      </div>

    </div>
  </div>

  @if (cargando()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status"></div>
    </div>
  }

  @if (!cargando()) {

    <div class="row g-4 mb-5">

      <div class="col-md-3">
        <div class="glass-card h-100 p-4 d-flex align-items-center justify-content-between text-success border-success border-opacity-25">
          <div>
            <p class="mb-1 text-muted fw-bold small text-uppercase">Valor Inventario</p>
            <h3 class="fw-bold mb-0">${{ kpis().valorTotal | number:'1.0-0' }}</h3>
          </div>
          <div class="icon-box bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-currency-dollar fs-3"></i>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="glass-card h-100 p-4 d-flex align-items-center justify-content-between text-primary border-primary border-opacity-25">
          <div>
            <p class="mb-1 text-muted fw-bold small text-uppercase">Productos</p>
            <h3 class="fw-bold mb-0">{{ kpis().totalProductos }}</h3>
          </div>
          <div class="icon-box bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-box-seam fs-3"></i>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="glass-card h-100 p-4 d-flex align-items-center justify-content-between text-danger border-danger border-opacity-25">
          <div>
            <p class="mb-1 text-muted fw-bold small text-uppercase">Stock Crítico</p>
            <h3 class="fw-bold mb-0">{{ kpis().stockBajo }}</h3>
          </div>
          <div class="icon-box bg-danger bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-exclamation-triangle fs-3"></i>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="glass-card h-100 p-4 d-flex align-items-center justify-content-between text-info border-info border-opacity-25">
          <div>
            <p class="mb-1 text-muted fw-bold small text-uppercase">Categorías</p>
            <h3 class="fw-bold mb-0">{{ kpis().totalCategorias }}</h3>
          </div>
          <div class="icon-box bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-tags fs-3"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">

      <div class="col-md-5">
        <div class="glass-card h-100 p-4">
          <h5 class="fw-bold mb-4 text-secondary">Distribución por Categoría</h5>
          <div class="d-flex justify-content-center">
             <canvas baseChart
                [data]="doughnutChartData"
                [type]="doughnutChartType"
                [options]="chartOptions">
             </canvas>
          </div>
        </div>
      </div>

      <div class="col-md-7">
        <div class="glass-card h-100 p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold mb-0 text-secondary">Actividad Reciente</h5>
            <button class="btn btn-sm btn-outline-primary rounded-pill" routerLink="/administracion/movimientos">Ver Todo</button>
          </div>

          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <tbody>
                @for (mov of movimientos(); track mov.id) {
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="me-3 rounded-circle d-flex align-items-center justify-content-center"
                             [class.bg-success]="mov.tipo == 'IN'"
                             [class.bg-danger]="mov.tipo == 'OUT'"
                             class="bg-opacity-10" style="width: 35px; height: 35px;">
                          @if(mov.tipo == 'IN'){ <i class="bi bi-arrow-up text-success"></i> }
                          @else { <i class="bi bi-arrow-down text-danger"></i> }
                        </div>
                        <div>
                          <div class="fw-bold text-dark">{{ mov.producto }}</div>
                          <div class="small text-muted">{{ mov.fecha_hora | date:'shortTime' }} - {{ mov.nombre_usuario }}</div>
                        </div>
                      </div>
                    </td>
                    <td class="text-end fw-bold"
                        [class.text-success]="mov.tipo == 'IN'"
                        [class.text-danger]="mov.tipo == 'OUT'">
                      {{ mov.tipo == 'IN' ? '+' : '-' }}{{ mov.cantidad }}
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

        </div>
      </div>

    </div>
  }
</div>
